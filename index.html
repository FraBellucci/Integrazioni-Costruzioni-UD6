<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UD6 - Gestione Interferenze PSC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
            line-height: 1.5;
        }

        .content {
            padding: 30px;
        }

        .instructions {
            background: #f7fafc;
            border-left: 4px solid #4299e1;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 4px;
        }

        .instructions h3 {
            color: #2d3748;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .instructions p {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .score-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #edf2f7;
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 13px;
            color: #718096;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .score-value {
            font-size: 32px;
            font-weight: bold;
            color: #2d3748;
            margin-top: 5px;
        }

        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 25px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #e2e8f0;
        }

        .legend-text {
            font-size: 14px;
            color: #4a5568;
            font-weight: 500;
        }

        .timeline {
            overflow-x: auto;
            margin-bottom: 30px;
        }

        .timeline-grid {
            display: grid;
            grid-template-columns: 150px repeat(20, 60px);
            gap: 1px;
            background: #cbd5e0;
            border: 1px solid #cbd5e0;
            min-width: 900px;
        }

        .cell {
            background: white;
            padding: 12px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
        }

        .cell.header-cell {
            background: #2d3748;
            color: white;
            font-weight: 600;
            font-size: 12px;
            text-align: center;
        }

        .cell.company-cell {
            background: #edf2f7;
            font-weight: 600;
            color: #2d3748;
            justify-content: flex-start;
            padding-left: 15px;
        }

        .cell.work-cell {
            position: relative;
        }

        .company-a { background: #fc8181; }
        .company-b { background: #63b3ed; }
        .company-c { background: #68d391; }
        .company-d { background: #f6ad55; }

        .cell.interference {
            border: 3px solid #f6ad55;
            box-shadow: 0 0 0 4px rgba(246, 173, 85, 0.3);
            cursor: pointer;
            transition: all 0.2s;
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0%, 100% { box-shadow: 0 0 0 4px rgba(246, 173, 85, 0.3); }
            50% { box-shadow: 0 0 0 4px rgba(246, 173, 85, 0.6); }
        }

        .cell.interference:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .cell.interference.answered {
            border-color: #48bb78;
            box-shadow: 0 0 0 4px rgba(72, 187, 120, 0.3);
            animation: none;
        }

        .cell.interference::after {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 16px;
        }

        .cell.interference.answered::after {
            content: '‚úì';
            color: #48bb78;
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 22px;
        }

        .interference-details {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #f6ad55;
        }

        .interference-details p {
            color: #4a5568;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .interference-details strong {
            color: #2d3748;
        }

        .modal-content .question {
            color: #2d3748;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-size: 15px;
            color: #2d3748;
        }

        .option-btn:hover {
            border-color: #4299e1;
            background: #ebf8ff;
            transform: translateX(5px);
        }

        .option-btn.correct {
            background: #c6f6d5;
            border-color: #48bb78;
        }

        .option-btn.wrong {
            background: #fed7d7;
            border-color: #f56565;
        }

        .feedback {
            display: none;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .feedback.active {
            display: block;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }

        .feedback.wrong {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #f56565;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            display: none;
            background: #f7fafc;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
        }

        .results.active {
            display: block;
        }

        .results h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .final-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 20px;
        }

        .final-score h2 {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .final-score p {
            font-size: 18px;
            opacity: 0.9;
        }

        .result-item {
            background: white;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 6px;
            border-left: 4px solid #cbd5e0;
        }

        .result-item.correct {
            border-left-color: #48bb78;
        }

        .result-item.incorrect {
            border-left-color: #f56565;
        }

        .result-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .result-desc {
            color: #718096;
            font-size: 14px;
            line-height: 1.5;
        }

        .verify-btn-container {
            text-align: center;
            margin-top: 30px;
        }

        .note {
            background: #ebf8ff;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            font-size: 14px;
            color: #2c5282;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèóÔ∏è UD6 - Gestione Interferenze nel PSC</h1>
            <p>Per ogni interferenza evidenziata, rispondi alle domande o scegli le misure di coordinamento</p>
        </div>

        <div class="content">
            <div class="instructions">
                <h3>üìã Istruzioni</h3>
                <p><strong>Scenario:</strong> Cantiere di ristrutturazione con 4 imprese che lavorano contemporaneamente in zone diverse.</p>
                <p><strong>Obiettivo:</strong> Nel cronoprogramma sono evidenziate 5 interferenze critiche (celle con bordo arancione ‚ö†Ô∏è)</p>
                <p><strong>Compito:</strong> Clicca su ogni interferenza evidenziata e rispondi alle domande per gestirla correttamente.</p>
                <p><strong>Domande:</strong> Alternano tra "Qual √® il motivo dell'interferenza?" e "Quale misura di coordinamento adotti?"</p>
            </div>

            <div class="score-panel">
                <div class="score-item">
                    <div class="score-label">Risposte corrette</div>
                    <div class="score-value" id="correctCount">0 / 5</div>
                </div>
                <div class="score-item">
                    <div class="score-label">Punteggio</div>
                    <div class="score-value" id="score">0</div>
                </div>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color company-a"></div>
                    <div class="legend-text">Impresa A - Demolizioni (Piano 2)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color company-b"></div>
                    <div class="legend-text">Impresa B - Impianto elettrico (Piano 1)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color company-c"></div>
                    <div class="legend-text">Impresa C - Opere murarie (Piano 1)</div>
                </div>
                <div class="legend-item">
                    <div class="legend-color company-d"></div>
                    <div class="legend-text">Impresa D - Ponteggio (Esterno)</div>
                </div>
            </div>

            <div class="timeline">
                <div class="timeline-grid" id="timelineGrid"></div>
            </div>

            <div class="verify-btn-container">
                <button class="btn-primary" id="verifyBtn">Visualizza Risultati Finali</button>
            </div>

            <div class="results" id="results"></div>
        </div>
    </div>

    <!-- Modal per domande -->
    <div class="modal" id="questionModal">
        <div class="modal-content">
            <h3 id="modalTitle">Interferenza Rilevata</h3>
            <div class="interference-details" id="interferenceDetails"></div>
            <div class="question" id="modalQuestion"></div>
            <div class="options" id="modalOptions"></div>
            <div class="feedback" id="feedback"></div>
            <button class="btn-primary" id="nextBtn" style="display: none;">Continua</button>
        </div>
    </div>

    <script>
        // Dati del cronoprogramma
        const companies = [
            { id: 'A', name: 'Impresa A - Demolizioni (Piano 2)', days: [1,2,3,4,5,6,7,8,9,10], color: 'company-a' },
            { id: 'B', name: 'Impresa B - Elettrico (Piano 1)', days: [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15], color: 'company-b' },
            { id: 'C', name: 'Impresa C - Murarie (Piano 1)', days: [5,6,7,8,9,10,11,12,13,14], color: 'company-c' },
            { id: 'D', name: 'Impresa D - Ponteggio (Esterno)', days: [1,2,3,16,17,18,19,20], color: 'company-d' }
        ];

        // 5 interferenze con domande alternate
        const interferences = [
            {
                id: 1,
                day: 3,
                companies: ['A', 'B'],
                context: 'Impresa A demolisce al Piano 2, mentre Impresa B installa impianto elettrico al Piano 1 sottostante',
                type: 'reason', // domanda sul motivo
                question: 'Qual √® il principale rischio di questa interferenza?',
                options: [
                    { text: 'Rischio caduta materiali dall\'alto sul personale sottostante', correct: true },
                    { text: 'Interferenza solo logistica negli accessi', correct: false },
                    { text: 'Rumore eccessivo che disturba i lavori', correct: false },
                    { text: 'Nessun rischio reale, sono su piani diversi', correct: false }
                ],
                correctFeedback: 'Corretto! Le demolizioni sopra lavori elettrici creano grave rischio caduta materiali. Art. 96 D.Lgs. 81/2008.',
                wrongFeedback: 'Errato. Il rischio principale √® la caduta di materiali pesanti dall\'alto che pu√≤ colpire gli elettricisti al piano inferiore.'
            },
            {
                id: 2,
                day: 2,
                companies: ['A', 'D'],
                context: 'Impresa A demolisce Piano 2, mentre Impresa D monta il ponteggio esterno',
                type: 'solution', // domanda sulla soluzione
                question: 'Quale misura di coordinamento √® pi√π efficace?',
                options: [
                    { text: 'Separazione temporale: montaggio ponteggio solo quando demolizioni sono completate', correct: false },
                    { text: 'Delimitazione area con teli di protezione sul ponteggio + orari sfalsati', correct: true },
                    { text: 'Nessuna misura: il ponteggio √® esterno, non c\'√® interferenza', correct: false },
                    { text: 'Sospendere entrambe le attivit√† fino a soluzione definitiva', correct: false }
                ],
                correctFeedback: 'Esatto! Protezione fisica + coordinamento temporale secondo art. 95 e 97 D.Lgs. 81/2008.',
                wrongFeedback: 'No. Serve protezione fisica (teli) + coordinamento orari per evitare caduta detriti su ponteggiatori.'
            },
            {
                id: 3,
                day: 7,
                companies: ['B', 'C'],
                context: 'Impresa B (elettrico) e Impresa C (murarie) lavorano entrambe al Piano 1 nella stessa area',
                type: 'reason', // motivo
                question: 'Perch√© questa √® un\'interferenza da gestire?',
                options: [
                    { text: 'Solo questione di spazio: basta organizzare meglio', correct: false },
                    { text: 'Rischio polveri da murature su impianti elettrici + sovrapposizione spaziale', correct: true },
                    { text: 'Incompatibilit√† personale tra i capicantiere', correct: false },
                    { text: 'Non √® un\'interferenza: possono lavorare insieme', correct: false }
                ],
                correctFeedback: 'Corretto! Polveri su impianti elettrici + interferenza fisica richiedono coordinamento (art. 26 D.Lgs. 81/2008).',
                wrongFeedback: 'Sbagliato. Le polveri da muratura danneggiano gli impianti elettrici e c\'√® conflitto nell\'uso dello spazio.'
            },
            {
                id: 4,
                day: 9,
                companies: ['A', 'C'],
                context: 'Impresa A termina demolizioni Piano 2, Impresa C lavora alle murature Piano 1',
                type: 'solution', // soluzione
                question: 'Come coordini queste due attivit√† sovrapposte?',
                options: [
                    { text: 'Nessun coordinamento: sono su piani diversi quindi sicure', correct: false },
                    { text: 'Coordinamento accessi + verifica stabilit√† strutturale prima murature', correct: true },
                    { text: 'Sospendere le murature fino al termine totale demolizioni', correct: false },
                    { text: 'Barriere fisiche tra i due piani', correct: false }
                ],
                correctFeedback: 'Esatto! Serve coordinare accessi e verificare che le demolizioni non compromettano la stabilit√† per le murature.',
                wrongFeedback: 'No. Le demolizioni possono aver indebolito strutture: serve verifica prima di caricare con murature.'
            },
            {
                id: 5,
                day: 10,
                companies: ['B', 'C'],
                context: 'Impresa B (elettrico) e C (murarie) ancora sovrapposte al Piano 1 - fase critica finale',
                type: 'solution', // soluzione
                question: 'Misura prioritaria per questa fase critica?',
                options: [
                    { text: 'Riunione di coordinamento quotidiana + separazione oraria 4h ciascuno', correct: true },
                    { text: 'Continuare senza modifiche: ormai si conoscono', correct: false },
                    { text: 'Far lavorare una sola impresa per volta', correct: false },
                    { text: 'Richiedere al committente di modificare il PSC', correct: false }
                ],
                correctFeedback: 'Perfetto! Coordinamento quotidiano + turnazione oraria (art. 92 e 97 D.Lgs. 81/2008).',
                wrongFeedback: 'Errato. Nelle fasi critiche serve coordinamento quotidiano formale con separazione temporale rigida.'
            }
        ];

        let answeredInterferences = {};
        let correctAnswers = 0;
        let currentInterference = null;

        // Genera la griglia
        function generateTimeline() {
            const grid = document.getElementById('timelineGrid');
            
            // Header row
            grid.innerHTML = '<div class="cell header-cell">Impresa / Giorno</div>';
            for (let day = 1; day <= 20; day++) {
                grid.innerHTML += `<div class="cell header-cell">G${day}</div>`;
            }

            // Rows per ogni impresa
            companies.forEach(company => {
                grid.innerHTML += `<div class="cell company-cell">${company.name}</div>`;
                
                for (let day = 1; day <= 20; day++) {
                    const isWorkDay = company.days.includes(day);
                    const interference = interferences.find(
                        int => int.day === day && int.companies.includes(company.id)
                    );
                    
                    if (isWorkDay) {
                        let classes = `cell work-cell ${company.color}`;
                        let cellId = `cell-${company.id}-${day}`;
                        
                        if (interference) {
                            classes += ' interference';
                            grid.innerHTML += `<div class="${classes}" data-interference="${interference.id}" id="${cellId}"></div>`;
                        } else {
                            grid.innerHTML += `<div class="${classes}" id="${cellId}"></div>`;
                        }
                    } else {
                        grid.innerHTML += `<div class="cell"></div>`;
                    }
                }
            });

            // Event listeners sulle interferenze
            document.querySelectorAll('.interference').forEach(cell => {
                cell.addEventListener('click', handleInterferenceClick);
            });
        }

        function handleInterferenceClick(e) {
            const interferenceId = parseInt(e.target.dataset.interference);
            
            // Se gi√† risposta, non fare nulla
            if (answeredInterferences[interferenceId]) {
                return;
            }

            const interference = interferences.find(i => i.id === interferenceId);
            showInterferenceModal(interference);
        }

        function showInterferenceModal(interference) {
            currentInterference = interference;
            
            const modal = document.getElementById('questionModal');
            const title = document.getElementById('modalTitle');
            const details = document.getElementById('interferenceDetails');
            const question = document.getElementById('modalQuestion');
            const optionsDiv = document.getElementById('modalOptions');
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('nextBtn');

            title.textContent = `Interferenza ${interference.id} - Giorno ${interference.day}`;
            
            details.innerHTML = `
                <p><strong>Imprese coinvolte:</strong> ${interference.companies.join(' + ')}</p>
                <p><strong>Contesto:</strong> ${interference.context}</p>
            `;

            question.textContent = interference.question;

            optionsDiv.innerHTML = '';
            feedback.classList.remove('active', 'correct', 'wrong');
            nextBtn.style.display = 'none';

            interference.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option.text;
                btn.onclick = () => handleAnswer(option.correct, btn, interference);
                optionsDiv.appendChild(btn);
            });

            modal.classList.add('active');
        }

        function handleAnswer(isCorrect, btn, interference) {
            const feedback = document.getElementById('feedback');
            const nextBtn = document.getElementById('nextBtn');
            const optionsDiv = document.getElementById('modalOptions');

            // Disabilita tutti i pulsanti
            optionsDiv.querySelectorAll('.option-btn').forEach(b => {
                b.style.pointerEvents = 'none';
                if (b === btn) {
                    b.classList.add(isCorrect ? 'correct' : 'wrong');
                }
            });

            // Mostra feedback
            feedback.textContent = isCorrect ? interference.correctFeedback : interference.wrongFeedback;
            feedback.classList.add('active', isCorrect ? 'correct' : 'wrong');

            if (isCorrect) {
                correctAnswers++;
                answeredInterferences[interference.id] = true;
                
                // Marca le celle come answered
                interference.companies.forEach(comp => {
                    const cell = document.querySelector(`[data-interference="${interference.id}"][id^="cell-${comp}"]`);
                    if (cell) cell.classList.add('answered');
                });
            }

            updateScore();
            nextBtn.style.display = 'block';
            nextBtn.onclick = closeModal;
        }

        function closeModal() {
            document.getElementById('questionModal').classList.remove('active');
        }

        function updateScore() {
            document.getElementById('correctCount').textContent = `${correctAnswers} / 5`;
            document.getElementById('score').textContent = correctAnswers * 20;
        }

        function showResults() {
            const resultsDiv = document.getElementById('results');
            const percentage = (correctAnswers / 5) * 100;

            let evaluation = '';
            if (percentage === 100) evaluation = 'üèÜ Eccellente! Perfetta gestione delle interferenze!';
            else if (percentage >= 80) evaluation = '‚úÖ Ottimo! Buona competenza nel coordinamento.';
            else if (percentage >= 60) evaluation = 'üëç Sufficiente. Rivedi alcuni concetti del PSC.';
            else evaluation = '‚ö†Ô∏è Insufficiente. Studia meglio l\'art. 92 e 96 D.Lgs. 81/2008.';

            let html = `
                <div class="final-score">
                    <h2>${correctAnswers} / 5</h2>
                    <p>${evaluation}</p>
                    <p style="font-size: 16px; margin-top: 10px;">Punteggio: ${correctAnswers * 20}/100</p>
                </div>
                <h3>üìä Riepilogo Interferenze</h3>
            `;

            interferences.forEach(int => {
                const wasCorrect = answeredInterferences[int.id];
                html += `
                    <div class="result-item ${wasCorrect ? 'correct' : 'incorrect'}">
                        <div class="result-title">
                            ${wasCorrect ? '‚úÖ' : '‚ùå'} Interferenza ${int.id} - Giorno ${int.day}
                        </div>
                        <div class="result-desc">
                            <strong>Imprese:</strong> ${int.companies.join(' + ')}<br>
                            <strong>Contesto:</strong> ${int.context}<br>
                            <strong>Tipo domanda:</strong> ${int.type === 'reason' ? 'Motivo interferenza' : 'Soluzione coordinamento'}
                        </div>
                    </div>
                `;
            });

            html += `
                <div class="note">
                    <strong>üìö Riferimenti normativi:</strong><br>
                    ‚Ä¢ Art. 92 D.Lgs. 81/2008 - Obblighi del coordinatore per l'esecuzione<br>
                    ‚Ä¢ Art. 96 D.Lgs. 81/2008 - Obblighi dei datori di lavoro e coordinamento<br>
                    ‚Ä¢ Art. 97 - Obblighi dell'impresa affidataria<br>
                    ‚Ä¢ Allegato XV - Contenuti minimi del PSC
                </div>
            `;

            resultsDiv.innerHTML = html;
            resultsDiv.classList.add('active');
            document.getElementById('verifyBtn').disabled = true;
        }

        // Initialize
        generateTimeline();
        document.getElementById('verifyBtn').addEventListener('click', showResults);

        // Chiudi modal cliccando fuori
        document.getElementById('questionModal').addEventListener('click', (e) => {
            if (e.target.id === 'questionModal') {
                e.target.classList.remove('active');
            }
        });
    </script>
</body>
</html>
